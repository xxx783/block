# 免费观影应用启动指南

## 关于错误的说明

您遇到的错误可能有两种情况：

1. **运行了错误的文件**：之前您遇到的 `NameError: name 'User' is not defined` 错误是因为运行了错误目录下的 `app.py` 文件。
   - 错误路径：`G:\AI代码工具\python程序\博客-king\app.py`
   - 正确路径：`G:\AI代码工具\python程序\python\免费观影-king\app.py`

2. **数据库访问问题**：现在遇到的 `sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) unable to open database file` 错误是因为SQLite无法访问或创建数据库文件。
   这通常是由于权限问题或数据库文件/目录不存在导致的。

## 如何正确启动应用

### 第一步：初始化数据库（解决SQLite无法打开问题）

为了解决 `sqlite3.OperationalError: unable to open database file` 错误，请先执行以下操作：

1. 双击运行当前目录下的 `初始化数据库.bat` 文件
2. 这个脚本会：
   - 检查并创建必要的 `instance` 目录
   - 使用绝对路径创建和配置SQLite数据库
   - 创建所有必要的数据库表
   - 添加示例数据（包括管理员账号和普通用户账号）

### 第二步：启动应用

完成数据库初始化后，您可以通过以下两种方式启动应用：

#### 方法一：使用启动脚本（推荐）

1. 直接双击运行当前目录下的 `run_app.bat` 文件
2. 这将自动在正确的目录下启动Flask应用

### 方法二：手动在命令行启动

1. 打开命令提示符（CMD）
2. 切换到正确的目录：
   ```
   cd /d G:\AI代码工具\python程序\python\免费观影-king
   ```
3. 安装所需依赖（首次运行时）：
   ```
   pip install -r requirements.txt
   ```
4. 启动应用：
   ```
   python app.py
   ```

## 依赖项安装

如果您是首次运行或遇到依赖错误，请确保已安装所有必要的包：

- Flask 2.3.3
- Flask-WTF 1.2.1
- Flask-SQLAlchemy 3.0.5
- Werkzeug 2.3.7
- pytz 2020.1
- markdown 3.4.4

requirements.txt 文件中已包含所有这些依赖，您可以通过以下命令一次性安装：
```
pip install -r requirements.txt
```

## 其他注意事项

1. 确保您的Python版本与项目兼容（推荐Python 3.8+）
2. 如果需要配置MySQL数据库，请参考目录下的 `MySQL数据库配置指南.md`
3. 如果需要配置邮件功能，请参考 `QQ邮箱SMTP配置指南.md` 和 `邮件配置说明.md`

## 关于SQLite数据库问题的详细说明

### 常见错误原因

`sqlite3.OperationalError: unable to open database file` 错误通常由以下原因导致：

1. **目录不存在**：SQLite需要的 `instance` 目录不存在
2. **权限问题**：应用没有创建或写入数据库文件的权限
3. **路径问题**：相对路径解析错误，尤其是在不同环境中运行时

### 我们的解决方案

为了解决这些问题，我们做了以下改进：

1. **创建了专用的数据库初始化工具**：`initialize_database.py` 和 `初始化数据库.bat`
2. **使用绝对路径**：修改了 `app.py` 中的数据库配置，使用绝对路径访问数据库文件
3. **自动创建必要目录**：初始化脚本会自动检查并创建 `instance` 目录
4. **添加示例数据**：初始化脚本会创建管理员账号和普通用户账号，方便测试和使用

### 默认账号信息

初始化数据库后，系统会自动创建以下账号：
- **管理员账号**：用户名 `admin`，密码 `admin123`
- **普通用户账号**：用户名 `user1`，密码 `user123`

您可以使用这些账号登录系统，或者在登录后创建新的账号。

如有其他问题，请确保您正在运行正确目录下的应用！