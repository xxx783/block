# 免费观影应用 - 打包与运行指南

## 一、应用概述

这是一个基于Flask和SQLite开发的免费观影应用，您已经将其打包为可执行文件（app.exe）。本指南将帮助您了解如何正确运行打包后的应用，以及如何处理可能遇到的问题。

## 二、文件结构说明

打包后的应用主要包含以下文件和目录：

```
dist/app/
├── app.exe           # 主程序可执行文件
├── instance/         # 数据库目录（重要！）
│   └── app.db        # SQLite数据库文件
├── _internal/        # 内部依赖文件（无需修改）
├── 运行应用.bat      # 运行脚本（双击即可）
└── 运行指南.txt      # 本指南文件
```

## 三、运行应用

### 方法1：使用运行脚本（推荐）

1. 找到 `dist/app/运行应用.bat` 文件
2. 双击该文件即可启动应用
3. 启动后会显示命令窗口，请勿关闭

### 方法2：直接运行可执行文件

1. 找到 `dist/app/app.exe` 文件
2. 双击该文件启动应用
3. 启动后会显示命令窗口，请勿关闭

> **注意：** 首次运行可能需要几秒钟时间加载资源，请耐心等待。

## 四、数据库说明

### 数据库位置

- 应用使用SQLite数据库存储所有数据
- 数据库文件位于 `instance/app.db`
- 请确保此文件与app.exe在同一目录层级（即 `dist/app/instance/app.db`）

### 数据库权限要求

- 应用需要对数据库文件有**读/写权限**
- 如果遇到"无法打开数据库"或"权限被拒绝"的错误，请尝试以管理员身份运行

### 数据库备份

- 在重新打包应用时，build_app.py脚本会自动备份数据库文件
- 备份文件位于项目根目录的 `db_backups` 文件夹中
- 如果数据库损坏，可以从备份文件恢复

## 五、常见问题与解决方案

### 1. 无法连接到数据库

**现象：** 应用启动后显示"无法打开数据库文件"或类似错误

**解决方法：**
- 检查 `instance` 目录是否存在，如果不存在请手动创建
- 确认 `instance/app.db` 文件是否存在
- 右键点击app.exe，选择"以管理员身份运行"
- 检查文件权限，确保当前用户有读写权限

### 2. 应用启动后闪退

**现象：** 双击app.exe后窗口闪现一下就消失

**解决方法：**
- 使用命令提示符运行app.exe，查看具体错误信息
- 检查数据库文件是否存在且完整
- 确认instance目录是否正确创建

### 3. 功能无法正常使用

**现象：** 应用启动成功，但某些功能无法使用

**解决方法：**
- 检查数据库文件是否包含完整的数据
- 尝试使用备份文件恢复数据库
- 确保应用有足够的权限创建临时文件

### 4. 端口被占用

**现象：** 应用提示"Address already in use"或"端口已被占用"

**解决方法：**
- 关闭占用相同端口的其他程序
- 重启电脑后再次尝试运行

## 六、重新打包应用

如果您对代码进行了修改，需要重新打包应用，请按照以下步骤操作：

1. 确保已安装Python环境和所有依赖
2. 运行项目根目录下的 `build_app.py` 脚本：
   ```
   python build_app.py
   ```
3. 脚本会自动执行以下操作：
   - 检查并安装所有依赖
   - 备份数据库文件
   - 清理旧的构建文件
   - 使用优化的配置重新打包应用
   - 复制数据库文件到打包目录
   - 创建运行脚本

## 七、注意事项

1. **不要删除或移动instance目录** - 这会导致应用无法访问数据
2. **定期备份数据库文件** - 建议手动备份重要数据
3. **请勿关闭命令窗口** - 关闭命令窗口会终止应用运行
4. **移动应用时请保持目录结构** - 确保app.exe与instance目录在同一文件夹下
5. **如果需要在其他电脑上运行** - 请确保完整复制整个app目录，包括instance文件夹

## 八、技术支持

如果您在使用过程中遇到无法解决的问题，可以尝试以下方法：

1. 检查应用日志输出（在命令窗口中）
2. 使用项目根目录下的 `test_packaged_app.py` 测试数据库连接
3. 重新打包应用（运行build_app.py）

---

**最后更新时间：** 2025-09-07 19:45:00