# 虚拟主机(无命令行)部署指南

本指南专为无法使用命令行的虚拟主机环境设计，提供了通过FTP/SFTP上传文件和Web控制面板配置的详细步骤。

## 一、环境检查

首先确认您的虚拟主机满足以下要求：
- 支持Python 3.6或更高版本
- 提供Web控制面板（如cPanel、Plesk等）
- 允许通过FTP/SFTP上传文件
- 支持WSGI应用部署（通常虚拟主机会提供Python应用部署功能）

## 二、准备文件

在本地计算机上准备以下文件和目录：

1. **app.py** - 应用主文件（需要修改配置）
2. **requirements.txt** - 依赖列表
3. **templates/** - 模板目录
4. **static/** - 静态文件目录
5. **instance/** - 数据库目录（空目录即可）

## 三、修改配置文件

### 1. 修改app.py配置

在本地编辑app.py文件，进行以下修改：

```python
# 修改debug模式为False（生产环境）
if __name__ == '__main__':
    app.run(debug=False, host='0.0.0.0', port=5000)

# 配置为使用相对路径（避免权限问题）
import os

base_dir = os.path.dirname(os.path.abspath(__file__))
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///' + os.path.join(base_dir, 'instance', 'app.db')

# 如果虚拟主机提供了数据库，可以考虑使用MySQL
# app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://username:password@localhost/dbname'
```

### 2. 添加WSGI入口文件

创建一个新的`wsgi.py`文件（如果没有的话），内容如下：

```python
from app import app

if __name__ == "__main__":
    app.run()
```

## 四、通过FTP/SFTP上传文件

使用您的FTP客户端（如FileZilla）连接到虚拟主机，并上传所有文件：

1. 连接到虚拟主机的FTP/SFTP服务
2. 上传修改后的app.py文件
3. 上传requirements.txt文件
4. 上传wsgi.py文件（如果新建了）
5. 上传templates/目录及其所有内容
6. 上传static/目录及其所有内容
7. 创建并上传空的instance/目录

## 五、通过Web控制面板部署

### 1. 使用cPanel部署Python应用

如果您的虚拟主机使用cPanel：

1. 登录cPanel控制面板
2. 找到并点击"Python应用"或"Setup Python App"图标
3. 点击"Create Application"按钮
4. 选择Python版本（推荐3.6+）
5. 在"Application root"字段中，输入您上传应用文件的目录路径
6. 在"Application URL"字段中，选择要使用的域名和子目录
7. 在"Application startup file"字段中，输入wsgi.py
8. 在"Application entry point"字段中，输入app（即Flask应用实例名）
9. 点击"Create"按钮创建应用
10. 创建成功后，系统会自动安装依赖并启动应用

### 2. 使用Plesk部署Python应用

如果您的虚拟主机使用Plesk：

1. 登录Plesk控制面板
2. 转到"网站与域名"选项卡
3. 选择您要部署应用的域名
4. 找到并点击"Python"图标
5. 点击"Add Python Application"按钮
6. 选择Python版本（推荐3.6+）
7. 在"Application root"字段中，选择您上传应用文件的目录
8. 在"Application URL"字段中，设置应用的访问路径
9. 在"Application startup file"字段中，输入wsgi.py
10. 在"Application entry point"字段中，输入app
11. 点击"OK"按钮创建应用

## 六、数据库配置

### 1. SQLite数据库（默认）

对于SQLite数据库，您只需要确保instance目录存在且有正确的权限：

1. 通过FTP/SFTP检查instance目录是否存在
2. 如果不存在，创建一个空的instance目录
3. 确保虚拟主机的Python进程对该目录有写权限

### 2. 虚拟主机提供的数据库

如果您想使用虚拟主机提供的数据库：

1. 通过Web控制面板创建一个新的数据库
2. 记录数据库名称、用户名和密码
3. 修改app.py文件中的数据库配置：

```python
# MySQL配置示例
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://username:password@localhost/dbname'

# PostgreSQL配置示例
# app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://username:password@localhost/dbname'
```

4. 重新上传修改后的app.py文件
5. 通过Web控制面板重启Python应用

## 七、邮件配置

如果您需要使用邮件功能，需要修改app.py中的邮件配置：

```python
# 修改为您的邮箱配置
app.config['MAIL_SERVER'] = 'smtp.example.com'
app.config['MAIL_PORT'] = 465
app.config['MAIL_USE_SSL'] = True
app.config['MAIL_USERNAME'] = 'your-email@example.com'
app.config['MAIL_PASSWORD'] = 'your-email-password-or-app-password'
app.config['MAIL_DEFAULT_SENDER'] = 'your-email@example.com'
```

## 八、静态文件配置

### 1. 检查静态文件路径

确保您的HTML模板中使用了正确的静态文件路径：

```html
<!-- 正确的静态文件引用方式 -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="{{ url_for('static', filename='js/toast_animation.js') }}"></script>
```

### 2. 虚拟主机静态文件映射

某些虚拟主机可能需要单独配置静态文件目录：

- 在cPanel中，您可以在Python应用设置中找到"Passenger log file"选项下方配置静态文件映射
- 在Plesk中，您可以在Python应用设置中找到"Static files mappings"选项进行配置

## 九、常见问题与解决方案

### 1. 应用无法启动
- 检查Web控制面板中的错误日志
- 确认Python版本符合要求
- 检查wsgi.py文件是否正确配置

### 2. 数据库错误
- 确保instance目录存在且有写权限
- 检查数据库连接字符串是否正确
- 查看错误日志了解具体问题

### 3. 静态文件无法加载
- 确认static目录结构正确
- 检查模板中的静态文件引用路径
- 尝试在虚拟主机控制面板中配置静态文件映射

### 4. 邮件发送失败
- 确认邮件服务器配置正确
- 检查邮箱密码或授权码是否正确
- 有些虚拟主机可能限制了邮件发送功能，请联系虚拟主机提供商

## 十、更新应用

当需要更新应用时，按照以下步骤操作：

1. 在本地修改相应文件
2. 通过FTP/SFTP上传更新后的文件
3. 通过Web控制面板重启Python应用

---

请根据您的虚拟主机具体环境和控制面板类型调整上述配置。如有任何问题，请联系您的虚拟主机提供商的技术支持。